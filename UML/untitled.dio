<mxGraphModel dx="620" dy="581" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" background="#ffffff"><root><mxCell id="0"/><mxCell id="1" parent="0"/><mxCell id="2" value="&lt;span&gt;Flow:&lt;/span&gt;&lt;br&gt;&lt;span&gt;1. get vm_id_list from latest vms&lt;/span&gt;&lt;br&gt;&lt;span&gt;2. check the folders to see if the previous etl job is done&lt;/span&gt;&lt;br&gt;&lt;span&gt;3. call api to get vm_status during [snap_time_from, snap_time_to]&lt;/span&gt;" style="text;html=1;resizable=0;points=[];autosize=1;align=left;verticalAlign=top;spacingTop=-4;" vertex="1" parent="1"><mxGeometry x="80" y="160" width="370" height="60" as="geometry"/></mxCell><mxCell id="3" value="&lt;span&gt;step 2.&lt;/span&gt;&lt;br&gt;&lt;span&gt;look back 5 minutes util finding the last etl was done successfully,&amp;nbsp;&lt;/span&gt;&lt;div&gt;&lt;span&gt;do etl from the most remote past&lt;/span&gt;&lt;/div&gt;" style="text;html=1;resizable=0;points=[];autosize=1;align=left;verticalAlign=top;spacingTop=-4;" vertex="1" parent="1"><mxGeometry x="80" y="282" width="370" height="40" as="geometry"/></mxCell><mxCell id="4" value="&lt;div&gt;&lt;span&gt;step 3.&amp;nbsp;&lt;/span&gt;&lt;span&gt;storage:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;s3 &amp;gt; ml-[env]-model &amp;gt; ml/ &amp;gt; etl-workspace/ &amp;gt; vm-status/&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; └──&lt;font color=&quot;#007fff&quot;&gt;vm-status&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; ├──&lt;font color=&quot;#007fff&quot;&gt;2020-08-04T00&lt;/font&gt;&lt;font color=&quot;#ff0000&quot;&gt;-&amp;gt; means data exists in this dt hour (in vm_status, it follows snap_time)&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; │&amp;nbsp; &amp;nbsp;├──&lt;font color=&quot;#007fff&quot;&gt;2020-08-04T00:01:52&lt;/font&gt;&lt;font color=&quot;#ff0000&quot;&gt;-&amp;gt; means after we do etl, we prepare to write data at this moment&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; │&amp;nbsp; &amp;nbsp;│&amp;nbsp; &amp;nbsp;└── part00000.parquet&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; │&amp;nbsp; &amp;nbsp;├──&lt;font color=&quot;#007fff&quot;&gt;2020-08-04T00:06:47&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; │&amp;nbsp; &amp;nbsp;│&amp;nbsp; &amp;nbsp;└── part00000.parquet&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; │&amp;nbsp; &amp;nbsp;└──&lt;font color=&quot;#007fff&quot;&gt;2020-08-04T00:11:45&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; │&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;└── part00000.parquet&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; ├──&lt;font color=&quot;#007fff&quot;&gt;2020-08-04T01&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; │&amp;nbsp; &amp;nbsp;├──&lt;font color=&quot;#007fff&quot;&gt;2020-08-04T01:01:52&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; │&amp;nbsp; &amp;nbsp;│&amp;nbsp; &amp;nbsp;└── part00000.parquet&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; │&amp;nbsp; &amp;nbsp;├──&lt;font color=&quot;#007fff&quot;&gt;2020-08-04T01:06:47&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; │&amp;nbsp; &amp;nbsp;│&amp;nbsp; &amp;nbsp;└── part00000.parquet&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; │&amp;nbsp; &amp;nbsp;└──&lt;font color=&quot;#007fff&quot;&gt;2020-08-04T01:11:45&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; │&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;└── part00000.parquet&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; └──&lt;font color=&quot;#007fff&quot;&gt;2020-08-04T02&lt;/font&gt;&lt;/div&gt;" style="text;html=1;resizable=0;points=[];autosize=1;align=left;verticalAlign=top;spacingTop=-4;" vertex="1" parent="1"><mxGeometry x="80" y="480" width="560" height="270" as="geometry"/></mxCell><mxCell id="5" value="&lt;div style=&quot;text-align: left&quot;&gt;&lt;b&gt;&lt;u&gt;parameters:&lt;/u&gt;&lt;/b&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;b&gt;&lt;font color=&quot;#ffd966&quot;&gt;delta_minutes&lt;/font&gt;&lt;/b&gt;: a delta time from current time (utcnow),&amp;nbsp;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; to get a 'regular' sync start time,&amp;nbsp;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; usually the same as freq. of your cron-job&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;font color=&quot;#00ff00&quot;&gt;&lt;b&gt;dt_start_upper_bound&lt;/b&gt;&lt;/font&gt;: set a bound for traceback sync start time&amp;nbsp;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if some data haven't synced successfully&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;b&gt;&lt;font color=&quot;#ff8000&quot;&gt;ts_interval&lt;/font&gt;&lt;/b&gt;: time interval/period as a unit to sync data&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1"><mxGeometry x="500" y="90" width="360" height="170" as="geometry"/></mxCell><mxCell id="6" value="" style="endArrow=classic;html=1;" edge="1" parent="1"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="520" y="360" as="sourcePoint"/><mxPoint x="880" y="360" as="targetPoint"/></mxGeometry></mxCell><mxCell id="7" value="&lt;div style=&quot;text-align: center&quot;&gt;&lt;span style=&quot;letter-spacing: 0px&quot;&gt;current time&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: center&quot;&gt;(utcnow)&lt;/div&gt;" style="text;html=1;resizable=0;points=[];autosize=1;align=center;verticalAlign=top;spacingTop=-4;" vertex="1" parent="1"><mxGeometry x="860" y="370" width="80" height="30" as="geometry"/></mxCell><mxCell id="8" value="" style="endArrow=classic;html=1;strokeColor=#FF8000;" edge="1" parent="1"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="840" y="400" as="sourcePoint"/><mxPoint x="800" y="400" as="targetPoint"/></mxGeometry></mxCell><mxCell id="9" value="" style="endArrow=classic;html=1;strokeColor=#FF8000;" edge="1" parent="1"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="760" y="400" as="sourcePoint"/><mxPoint x="720" y="400" as="targetPoint"/></mxGeometry></mxCell><mxCell id="10" value="" style="endArrow=classic;html=1;strokeColor=#FF8000;" edge="1" parent="1"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="680" y="400" as="sourcePoint"/><mxPoint x="640" y="400" as="targetPoint"/></mxGeometry></mxCell><mxCell id="11" value="" style="endArrow=classic;html=1;strokeColor=#FF8000;" edge="1" parent="1"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="600" y="400" as="sourcePoint"/><mxPoint x="560" y="400" as="targetPoint"/></mxGeometry></mxCell><mxCell id="12" value="" style="endArrow=classic;html=1;strokeColor=#FF8000;" edge="1" parent="1"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="640" y="440" as="sourcePoint"/><mxPoint x="680" y="440" as="targetPoint"/></mxGeometry></mxCell><mxCell id="13" value="" style="endArrow=classic;html=1;strokeColor=#FF8000;" edge="1" parent="1"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="720" y="440" as="sourcePoint"/><mxPoint x="760" y="440" as="targetPoint"/></mxGeometry></mxCell><mxCell id="14" value="" style="endArrow=classic;html=1;strokeColor=#FF8000;" edge="1" parent="1"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="800" y="440" as="sourcePoint"/><mxPoint x="840" y="440" as="targetPoint"/></mxGeometry></mxCell><mxCell id="15" value="1:50" style="rounded=0;whiteSpace=wrap;html=1;align=center;" vertex="1" parent="1"><mxGeometry x="520" y="410" width="40" height="20" as="geometry"/></mxCell><mxCell id="16" value="1:55" style="rounded=0;whiteSpace=wrap;html=1;align=center;" vertex="1" parent="1"><mxGeometry x="600" y="410" width="40" height="20" as="geometry"/></mxCell><mxCell id="17" value="2:00" style="rounded=0;whiteSpace=wrap;html=1;align=center;" vertex="1" parent="1"><mxGeometry x="680" y="410" width="40" height="20" as="geometry"/></mxCell><mxCell id="18" value="2:05" style="rounded=0;whiteSpace=wrap;html=1;align=center;" vertex="1" parent="1"><mxGeometry x="760" y="410" width="40" height="20" as="geometry"/></mxCell><mxCell id="19" value="2:10" style="rounded=0;whiteSpace=wrap;html=1;align=center;" vertex="1" parent="1"><mxGeometry x="840" y="410" width="40" height="20" as="geometry"/></mxCell><mxCell id="20" value="&lt;font color=&quot;#00ff00&quot;&gt;O&lt;/font&gt;" style="text;html=1;resizable=0;points=[];autosize=1;align=center;verticalAlign=top;spacingTop=-4;" vertex="1" parent="1"><mxGeometry x="525" y="340" width="30" height="20" as="geometry"/></mxCell><mxCell id="21" value="&lt;font color=&quot;#ff0000&quot;&gt;X&lt;/font&gt;" style="text;html=1;resizable=0;points=[];autosize=1;align=center;verticalAlign=top;spacingTop=-4;" vertex="1" parent="1"><mxGeometry x="610" y="340" width="20" height="20" as="geometry"/></mxCell><mxCell id="22" value="&lt;font color=&quot;#ff0000&quot;&gt;X&lt;/font&gt;" style="text;html=1;resizable=0;points=[];autosize=1;align=center;verticalAlign=top;spacingTop=-4;" vertex="1" parent="1"><mxGeometry x="770" y="340" width="20" height="20" as="geometry"/></mxCell><mxCell id="23" value="&lt;font color=&quot;#ff0000&quot;&gt;X&lt;/font&gt;" style="text;html=1;resizable=0;points=[];autosize=1;align=center;verticalAlign=top;spacingTop=-4;" vertex="1" parent="1"><mxGeometry x="690" y="340" width="20" height="20" as="geometry"/></mxCell><mxCell id="25" value="&lt;span&gt;delta_minutes,&amp;nbsp;&lt;/span&gt;&lt;div&gt;&lt;span&gt;regular time to sync data&lt;br&gt;(&lt;/span&gt;&lt;span&gt;freq. of your cron-job&lt;/span&gt;&lt;span&gt;)&lt;/span&gt;&lt;/div&gt;" style="shape=process;whiteSpace=wrap;html=1;align=center;fillColor=#FFD966;" vertex="1" parent="1"><mxGeometry x="755" y="270" width="170" height="42" as="geometry"/></mxCell><mxCell id="26" value="" style="endArrow=classic;html=1;strokeColor=#FFD966;" edge="1" parent="1"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="880" y="337" as="sourcePoint"/><mxPoint x="780" y="337" as="targetPoint"/><Array as="points"><mxPoint x="880" y="320"/><mxPoint x="780" y="320"/></Array></mxGeometry></mxCell><mxCell id="27" value="dt_start_upper_bound&lt;div&gt;(a bound to traceback)&lt;/div&gt;" style="shape=process;whiteSpace=wrap;html=1;align=center;fillColor=#99FF99;" vertex="1" parent="1"><mxGeometry x="460" y="270" width="170" height="42" as="geometry"/></mxCell><mxCell id="28" value="" style="endArrow=classic;html=1;strokeColor=#00FF00;" edge="1" parent="1"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="870" y="355" as="sourcePoint"/><mxPoint x="530" y="345" as="targetPoint"/><Array as="points"><mxPoint x="870" y="325"/><mxPoint x="530" y="325"/></Array></mxGeometry></mxCell><mxCell id="29" value="" style="endArrow=classic;html=1;strokeColor=#FF8000;" edge="1" parent="1"><mxGeometry width="50" height="50" relative="1" as="geometry"><mxPoint x="560" y="440" as="sourcePoint"/><mxPoint x="600" y="440" as="targetPoint"/></mxGeometry></mxCell></root></mxGraphModel>